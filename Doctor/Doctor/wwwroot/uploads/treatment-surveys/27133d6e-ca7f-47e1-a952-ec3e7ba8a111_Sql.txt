Sql
-- Database yaratmaq
CREATE DATABASE ElectroMallDb;
GO

USE ElectroMallDb;
GO

-- Users cədvəli
CREATE TABLE Users (
    Id INT PRIMARY KEY IDENTITY(1,1),
    FirstName NVARCHAR(100) NOT NULL,
    LastName NVARCHAR(100) NOT NULL,
    Email NVARCHAR(150) UNIQUE NOT NULL,
    PasswordHash NVARCHAR(200) NOT NULL,
    CreatedDate DATETIME DEFAULT GETDATE()
);
-- 1) Verilənlər bazası
IF DB_ID('ElectroMallDb') IS NULL
    CREATE DATABASE ElectroMallDb;
GO
USE ElectroMallDb;
GO

-- 2) Products
IF OBJECT_ID('dbo.Products','U') IS NULL
CREATE TABLE dbo.Products(
    Id           INT IDENTITY(1,1) PRIMARY KEY,
    Name         NVARCHAR(256) NOT NULL,
    Subtext      NVARCHAR(512) NULL,
    [Description] NVARCHAR(MAX) NULL,
    Price        DECIMAL(18,2) NOT NULL,
    IsActive     BIT NOT NULL CONSTRAINT DF_Products_IsActive DEFAULT(1),
    CreatedDate  DATETIME2(7) NOT NULL CONSTRAINT DF_Products_CreatedDate DEFAULT (SYSUTCDATETIME())
);
GO

-- 3) Customers
IF OBJECT_ID('dbo.Customers','U') IS NULL
CREATE TABLE dbo.Customers(
    Id           INT IDENTITY(1,1) PRIMARY KEY,
    FirstName    NVARCHAR(128) NOT NULL,
    LastName     NVARCHAR(128) NOT NULL,
    Email        NVARCHAR(256) NOT NULL,
    Phone        NVARCHAR(64) NULL,
    CreatedDate  DATETIME2(7) NOT NULL CONSTRAINT DF_Customers_CreatedDate DEFAULT (SYSUTCDATETIME())
);
GO
CREATE INDEX IX_Customers_Email ON dbo.Customers(Email);
GO

-- 4) Orders
IF OBJECT_ID('dbo.Orders','U') IS NULL
CREATE TABLE dbo.Orders(
    Id           INT IDENTITY(1,1) PRIMARY KEY,
    OrderNumber  NVARCHAR(32)  NOT NULL,
    CustomerId   INT           NOT NULL,
    Status       INT           NOT NULL,  -- 0=Processing,1=OnHold,2=Shipped,3=Cancel
    CreatedDate  DATETIME2(7)  NOT NULL CONSTRAINT DF_Orders_CreatedDate DEFAULT (SYSUTCDATETIME()),
    CONSTRAINT UQ_Orders_OrderNumber UNIQUE(OrderNumber),
    CONSTRAINT FK_Orders_Customers FOREIGN KEY (CustomerId) REFERENCES dbo.Customers(Id) ON DELETE NO ACTION,
    CONSTRAINT CK_Orders_Status CHECK (Status IN (0,1,2,3))
);
GO
CREATE INDEX IX_Orders_CreatedDate ON dbo.Orders(CreatedDate);
GO

-- 5) OrderItems
IF OBJECT_ID('dbo.OrderItems','U') IS NULL
CREATE TABLE dbo.OrderItems(
    Id           INT IDENTITY(1,1) PRIMARY KEY,
    OrderId      INT NOT NULL,
    ProductId    INT NOT NULL,
    Quantity     INT NOT NULL CONSTRAINT DF_OrderItems_Quantity DEFAULT (1),
    UnitPrice    DECIMAL(18,2) NOT NULL,
    CreatedDate  DATETIME2(7) NOT NULL CONSTRAINT DF_OrderItems_CreatedDate DEFAULT (SYSUTCDATETIME()),
    CONSTRAINT FK_OrderItems_Orders   FOREIGN KEY (OrderId)   REFERENCES dbo.Orders(Id)   ON DELETE CASCADE,
    CONSTRAINT FK_OrderItems_Products FOREIGN KEY (ProductId) REFERENCES dbo.Products(Id) ON DELETE NO ACTION,
    CONSTRAINT CK_OrderItems_Quantity CHECK (Quantity > 0)
);
GO
CREATE INDEX IX_OrderItems_OrderId   ON dbo.OrderItems(OrderId);
CREATE INDEX IX_OrderItems_ProductId ON dbo.OrderItems(ProductId);
GO

-- 6) ContactQueries (Lead)
IF OBJECT_ID('dbo.ContactQueries','U') IS NULL
CREATE TABLE dbo.ContactQueries(
    Id           INT IDENTITY(1,1) PRIMARY KEY,
    FirstName    NVARCHAR(128) NOT NULL,
    LastName     NVARCHAR(128) NOT NULL,
    Email        NVARCHAR(256) NOT NULL,
    [Message]    NVARCHAR(MAX) NOT NULL,
    CreatedDate  DATETIME2(7) NOT NULL CONSTRAINT DF_ContactQueries_CreatedDate DEFAULT (SYSUTCDATETIME())
);
GO
CREATE INDEX IX_ContactQueries_CreatedDate ON dbo.ContactQueries(CreatedDate);
GO

-- (İstəyə görə test üçün kiçik seed)
-- INSERT INTO dbo.Products(Name,Price) VALUES (N'LED Panel 60x60',120),(N'Street Light 100W',240),(N'Smart Switch',35);
-- INSERT INTO dbo.Customers(FirstName,LastName,Email) VALUES (N'Aysel',N'Aliyeva','aysel@example.com'),(N'Kamran',N'Rustamov','kamran@example.com');
-- INSERT INTO dbo.Orders(OrderNumber,CustomerId,Status) VALUES (N'EM-1001',1,2),(N'EM-1002',2,0);
-- INSERT INTO dbo.OrderItems(OrderId,ProductId,Quantity,UnitPrice) VALUES (1,1,5,120),(1,3,2,35),(2,2,1,240);
-- INSERT INTO dbo.ContactQueries(FirstName,LastName,Email,[Message]) VALUES (N'Rəşad',N'M.', 'aysel@example.com', N'Qiymət sorğusu');





-- ABOUT CONTENT -----------------------------------------------------------
IF OBJECT_ID('dbo.AboutContents','U') IS NULL
CREATE TABLE dbo.AboutContents(
    Id           INT IDENTITY(1,1) CONSTRAINT PK_AboutContents PRIMARY KEY,
    Heading      NVARCHAR(256) NOT NULL,
    Subtext      NVARCHAR(1000) NULL,
    CreatedDate  DATETIME2(7)  NOT NULL CONSTRAINT DF_AboutContents_CreatedDate DEFAULT (SYSUTCDATETIME())
);
GO

-- 7 ŞƏKİL ÜÇÜN: OrderIndex 0..6, hər mövqedə 1 şəkil (unikal)
IF OBJECT_ID('dbo.AboutImages','U') IS NULL
CREATE TABLE dbo.AboutImages(
    Id             INT IDENTITY(1,1) CONSTRAINT PK_AboutImages PRIMARY KEY,
    AboutContentId INT NOT NULL,
    Url            NVARCHAR(1024) NOT NULL,
    OrderIndex     TINYINT NOT NULL,
    CreatedDate    DATETIME2(7) NOT NULL CONSTRAINT DF_AboutImages_CreatedDate DEFAULT (SYSUTCDATETIME()),
    CONSTRAINT FK_AboutImages_AboutContents FOREIGN KEY (AboutContentId) REFERENCES dbo.AboutContents(Id) ON DELETE CASCADE,
    CONSTRAINT CK_AboutImages_OrderIndex CHECK (OrderIndex BETWEEN 0 AND 6)
);
GO
CREATE UNIQUE INDEX UX_AboutImages_AboutContentId_OrderIndex
ON dbo.AboutImages(AboutContentId, OrderIndex);
GO

-- FAQS --------------------------------------------------------------------
IF OBJECT_ID('dbo.Faqs','U') IS NULL
CREATE TABLE dbo.Faqs(
    Id           INT IDENTITY(1,1) CONSTRAINT PK_Faqs PRIMARY KEY,
    FaqNumber    INT NOT NULL,                 -- sualın nömrəsi
    Question     NVARCHAR(1000) NOT NULL,
    Answer       NVARCHAR(MAX) NOT NULL,
    CreatedDate  DATETIME2(7) NOT NULL CONSTRAINT DF_Faqs_CreatedDate DEFAULT (SYSUTCDATETIME())
);
GO
-- Eyni nömrədən iki dənə olmasın (istəsən silə bilərsən)
CREATE UNIQUE INDEX UX_Faqs_FaqNumber ON dbo.Faqs(FaqNumber);
GO


-- =========================
-- PARTNERS & CONTRACTS
-- =========================
IF OBJECT_ID('dbo.Partners','U') IS NULL
CREATE TABLE dbo.Partners(
    Id           INT IDENTITY(1,1) CONSTRAINT PK_Partners PRIMARY KEY,
    [Name]       NVARCHAR(256) NOT NULL,
    LogoUrl      NVARCHAR(1024) NULL,             -- partnyorun loqosu/şəkli (istifadəçi saytında göstəriləcək)
    CreatedDate  DATETIME2(7)  NOT NULL CONSTRAINT DF_Partners_CreatedDate DEFAULT (SYSUTCDATETIME())
);
GO
CREATE UNIQUE INDEX UX_Partners_Name ON dbo.Partners([Name]);
GO

IF OBJECT_ID('dbo.PartnerContracts','U') IS NULL
CREATE TABLE dbo.PartnerContracts(
    Id               INT IDENTITY(1,1) CONSTRAINT PK_PartnerContracts PRIMARY KEY,
    PartnerId        INT           NOT NULL,
    ContractNumber   NVARCHAR(64)  NOT NULL,
    ContractFileUrl  NVARCHAR(1024) NULL,        -- müqavilə faylının linki (pdf, docx və s.)
    Amount           DECIMAL(18,2) NOT NULL CONSTRAINT DF_PartnerContracts_Amount DEFAULT(0), -- maliyyə dəstəyi
    CreatedDate      DATETIME2(7)  NOT NULL CONSTRAINT DF_PartnerContracts_CreatedDate DEFAULT (SYSUTCDATETIME()),
    CONSTRAINT FK_PartnerContracts_Partners
        FOREIGN KEY (PartnerId) REFERENCES dbo.Partners(Id) ON DELETE CASCADE
);
GO
CREATE UNIQUE INDEX UX_PartnerContracts_Partner_ContractNo
ON dbo.PartnerContracts(PartnerId, ContractNumber);
GO

-- (istəyə görə, test üçün kiçik seed)
-- INSERT INTO dbo.Partners([Name],LogoUrl) VALUES (N"ABC Group",'https://cdn/.../abc.png'),(N"XYZ Ltd",'https://cdn/.../xyz.png');
-- INSERT INTO dbo.PartnerContracts(PartnerId,ContractNumber,ContractFileUrl,Amount) VALUES
-- (1,'C-001','https://cdn/.../c001.pdf', 10000),(1,'C-002',NULL, 5000),(2,'C-100','https://cdn/.../c100.pdf', 2500);
